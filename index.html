<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  

  
  <title>Chronosa_Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Chronosa_Blog">
<meta property="og:url" content="https://chronosa.github.io/index.html">
<meta property="og:site_name" content="Chronosa_Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chronosa_Blog">
  
    <link rel="alternate" href="/atom.xml" title="Chronosa_Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>
</html>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Chronosa_Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://chronosa.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-gcp_1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/30/gcp_1/" class="article-date">
  <time datetime="2019-05-30T14:33:08.285Z" itemprop="datePublished">2019-05-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/30/gcp_1/">GCP NOTE-1</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="GCP"><a href="#GCP" class="headerlink" title="GCP"></a>GCP</h1><h2 id="GCP-입문"><a href="#GCP-입문" class="headerlink" title="GCP 입문"></a>GCP 입문</h2><p>GCP Monitoring 항목 정리와 관련하여 아래와 같이 문서를 정리하였다.<br>특히 GCP의 Stackdriver는 활용도가 무궁무진해보인다. 편리한 인터페이스, 다양한 Aggrigator 제공..<br>다만 아직 잘 이해가 안되는 것은 AWS나 Azure에 존재하는 VM(EC2)의 Status Check 항목이 명확하게 존재하지 않는다는 것인데, 이것이 uptime으로 해결되는 지는 더 알아봐야 할 것 같다.</p>
<h2 id="Basic"><a href="#Basic" class="headerlink" title="Basic"></a>Basic</h2><h3 id="GCP-Console"><a href="#GCP-Console" class="headerlink" title="GCP Console"></a>GCP Console</h3><p>GCP Console 접속 URL<br><a href="https://console.cloud.google.com/" target="_blank" rel="noopener">https://console.cloud.google.com/</a></p>
<h3 id="Setting-up-authentication-amp-Install-lib"><a href="#Setting-up-authentication-amp-Install-lib" class="headerlink" title="Setting up authentication &amp; Install lib"></a>Setting up authentication &amp; Install lib</h3><p><a href="https://cloud.google.com/monitoring/docs/reference/libraries#client-libraries-install-python" target="_blank" rel="noopener">https://cloud.google.com/monitoring/docs/reference/libraries#client-libraries-install-python</a></p>
<h3 id="처음-시작하는-이를-위한-Google-Cloud-Platform-과-Decision-Tree-1-2"><a href="#처음-시작하는-이를-위한-Google-Cloud-Platform-과-Decision-Tree-1-2" class="headerlink" title="처음 시작하는 이를 위한 Google Cloud Platform 과 Decision Tree 1/2"></a>처음 시작하는 이를 위한 Google Cloud Platform 과 Decision Tree 1/2</h3><p><a href="https://medium.com/@jwlee98/gcp-%EC%B2%98%EC%9D%8C-%EC%8B%9C%EC%9E%91%ED%95%98%EB%8A%94-%EC%9D%B4%EB%A5%BC-%EC%9C%84%ED%95%9C-google-cloud-platform-%EA%B3%BC-decision-tree-1-2-2c524e9c5055" target="_blank" rel="noopener">https://medium.com/@jwlee98/gcp-%EC%B2%98%EC%9D%8C-%EC%8B%9C%EC%9E%91%ED%95%98%EB%8A%94-%EC%9D%B4%EB%A5%BC-%EC%9C%84%ED%95%9C-google-cloud-platform-%EA%B3%BC-decision-tree-1-2-2c524e9c5055</a></p>
<hr>
<h2 id="Monitoring"><a href="#Monitoring" class="headerlink" title="Monitoring"></a>Monitoring</h2><h3 id="AWS-전문가를-위한-Google-Cloud-Platform-모니터링"><a href="#AWS-전문가를-위한-Google-Cloud-Platform-모니터링" class="headerlink" title="AWS 전문가를 위한 Google Cloud Platform: 모니터링"></a>AWS 전문가를 위한 Google Cloud Platform: 모니터링</h3><p>이미 AWS를 경험한 사람이라면, 아래 Document가 많은 도움이 될 것 같다.<br><a href="https://cloud.google.com/docs/compare/aws/monitoring?hl=ko#metric_collection" target="_blank" rel="noopener">https://cloud.google.com/docs/compare/aws/monitoring?hl=ko#metric_collection</a></p>
<h3 id="AWS-Cloudwatch-VS-GCP-Stackdriver"><a href="#AWS-Cloudwatch-VS-GCP-Stackdriver" class="headerlink" title="AWS Cloudwatch VS GCP Stackdriver"></a>AWS Cloudwatch VS GCP Stackdriver</h3><p><em>AWS Cloudwatch</em></p>
<blockquote>
<p>AWS Account -&gt; AWS Region -&gt; Metric Name -&gt; Namespace -&gt; Dimensions</p>
</blockquote>
<p><em>GCP Stackdriver Monitoring</em></p>
<blockquote>
<p>Stackdriver Workspace(S.W) -&gt; GCP Project -&gt; Resource Type -&gt; Metric Name -&gt; Label<br>S.W -&gt; Stackdriver Group -&gt; GCP Project -&gt; Resource Type -&gt; Metric Name -&gt; Label</p>
</blockquote>
<h3 id="Structure-of-Metric-Types"><a href="#Structure-of-Metric-Types" class="headerlink" title="Structure of Metric Types"></a>Structure of Metric Types</h3><p><a href="https://cloud.google.com/monitoring/api/v3/metrics-details" target="_blank" rel="noopener">https://cloud.google.com/monitoring/api/v3/metrics-details</a></p>
<h3 id="Metrics-List"><a href="#Metrics-List" class="headerlink" title="Metrics List"></a>Metrics List</h3><p><a href="https://cloud.google.com/monitoring/api/metrics" target="_blank" rel="noopener">https://cloud.google.com/monitoring/api/metrics</a></p>
<h3 id="GCP-Metrics-List"><a href="#GCP-Metrics-List" class="headerlink" title="GCP Metrics List"></a>GCP Metrics List</h3><p><a href="https://cloud.google.com/monitoring/api/metrics_gcp" target="_blank" rel="noopener">https://cloud.google.com/monitoring/api/metrics_gcp</a></p>
<h3 id="Compute-Engine-API"><a href="#Compute-Engine-API" class="headerlink" title="Compute Engine API"></a>Compute Engine API</h3><p><a href="https://cloud.google.com/compute/docs/reference/rest/v1/" target="_blank" rel="noopener">https://cloud.google.com/compute/docs/reference/rest/v1/</a></p>
<h3 id="가격-책정"><a href="#가격-책정" class="headerlink" title="가격 책정"></a>가격 책정</h3><p><a href="https://cloud.google.com/stackdriver/pricing" target="_blank" rel="noopener">https://cloud.google.com/stackdriver/pricing</a></p>
<h3 id="Google-Cloud-Status-Dashboard"><a href="#Google-Cloud-Status-Dashboard" class="headerlink" title="Google Cloud Status Dashboard"></a>Google Cloud Status Dashboard</h3><p><a href="https://status.cloud.google.com/" target="_blank" rel="noopener">https://status.cloud.google.com/</a></p>
<h3 id="Stackdriver-tips-and-tricks-Understanding-metrics-and-building-charts"><a href="#Stackdriver-tips-and-tricks-Understanding-metrics-and-building-charts" class="headerlink" title="Stackdriver tips and tricks: Understanding metrics and building charts"></a>Stackdriver tips and tricks: Understanding metrics and building charts</h3><p><a href="https://cloud.google.com/blog/products/management-tools/stackdriver-tips-and-tricks-understanding-metrics-and-building-charts" target="_blank" rel="noopener">https://cloud.google.com/blog/products/management-tools/stackdriver-tips-and-tricks-understanding-metrics-and-building-charts</a><br>Stackdriver metrics are one of three kinds: gauge, delta, and cumulative.<br>A gauge metric measures a value at a particular point in time; i.e., “CPU utilization” for a Compute Engine instance, or “Instance count” for an App Engine app. A chart of CPU utilization will have points showing, as expected, the CPU utilization at that moment in time.<br>A delta metric measures the change in a value over a sample period, often one minute. An example is the “Backend request count” for a load balancer. A chart of the backend request count will have one point for each minute, showing how many requests hit the load balancer in that minute.<br>A cumulative metric measures a value that constantly increases, such as “sent bytes count” for Firebase. Cumulative metrics are never drawn directly in practice; you always use aligners (discussed below) to turn them into gauge or delta metrics first. If you could draw the raw data for “sent bytes count,” you would see an ever-increasing line going up as the total number of sent bytes grows without bound.</p>
<h3 id="backend-health-check"><a href="#backend-health-check" class="headerlink" title="backend health check"></a>backend health check</h3><p><a href="https://cloud.google.com/sdk/gcloud/reference/compute/backend-services/get-health" target="_blank" rel="noopener">https://cloud.google.com/sdk/gcloud/reference/compute/backend-services/get-health</a></p>
<h3 id="가상-머신-오류"><a href="#가상-머신-오류" class="headerlink" title="가상 머신 오류"></a>가상 머신 오류</h3><p>가상 머신에 호스트 오류가 발생하고, 가상 머신이 다시 시작되었습니다. 어떻게 된 것일까요?<br>호스트 오류는 가상 머신을 호스팅하는 물리적 시스템에서 가상 머신 중단을 일으킨 하드웨어 또는 소프트웨어 문제가 발생했음을 의미합니다. Compute Engine은 이러한 이벤트를 감지하고, 사용자의 작업 로그에 compute.instances.hostError 항목을 추가합니다. 가상 머신이 자동으로 다시 시작하도록 설정된 경우(기본값), Google이 다른 물리적 시스템에서 사용자의 가상 머신을 다시 시작합니다.</p>
<p>일반적으로 물리적 하드웨어 오류 및 소프트웨어 오류가 발생할 수도 있지만, 이러한 오류는 매우 드물게 발생합니다. 이와 같은 시스템 중단 이벤트로부터 애플리케이션 및 서비스를 보호하기 위해서는 강력한 시스템 설계와 확장성 및 탄력성이 뛰어난 웹 애플리케이션 빌드가 필요합니다. 관리형 인스턴스 그룹을 사용하면 Compute Engine 인스턴스 그룹 간에 상태 확인 및 확장을 수행할 수 있습니다.<br><a href="https://cloud.google.com/compute/docs/faq#hosterror" target="_blank" rel="noopener">https://cloud.google.com/compute/docs/faq#hosterror</a></p>
<h3 id="Instance-Life-Cycle"><a href="#Instance-Life-Cycle" class="headerlink" title="Instance Life Cycle"></a>Instance Life Cycle</h3><p><a href="https://cloud.google.com/compute/docs/instances/instance-life-cycle" target="_blank" rel="noopener">https://cloud.google.com/compute/docs/instances/instance-life-cycle</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chronosa.github.io/2019/05/30/gcp_1/" data-id="cjwaremy80005evyskmgc44f2" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GCP/">GCP</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Monitoring/">Monitoring</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cloudformation_1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/30/cloudformation_1/" class="article-date">
  <time datetime="2019-05-30T14:32:17.717Z" itemprop="datePublished">2019-05-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/30/cloudformation_1/">cloudformation-1 (INTRO)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Cloudformation"><a href="#Cloudformation" class="headerlink" title="Cloudformation"></a>Cloudformation</h1><p>AWS CloudFormation에서는 클라우드 환경 내 모든 인프라 리소스를 설명하고 프로비저닝할 수 있도록 공통 언어를 제공합니다.</p>
<ul>
<li>Text 파일을 통한 모델링 - 구성 요소 표준화, 구성 규정 준수 가능</li>
<li>자동화 및 배포 - 오류 탐지 시 변경 사항 자동 롤백</li>
<li>Infra as a Code - 버전 제어, 검토, 배포 등의 작업이 가능</li>
</ul>
<p><img src="/images/cloudformation_flow.png" alt="cloudformation flow"><br><a href="https://aws.amazon.com/ko/cloudformation/" target="_blank" rel="noopener">소개</a></p>
<h2 id="Grammer"><a href="#Grammer" class="headerlink" title="Grammer"></a>Grammer</h2><p>WordPress Sample Template 내용을 보고 공부한 내용 정리<br><a href="https://s3-ap-northeast-1.amazonaws.com/cloudformation-templates-ap-northeast-1/WordPress_Single_Instance.template" target="_blank" rel="noopener">Sample Code</a></p>
<h1 id="구성요소"><a href="#구성요소" class="headerlink" title="구성요소"></a>구성요소</h1><ol>
<li>AWSTemplateFormatVersion</li>
<li>Description</li>
<li>Parameters</li>
<li>Mappings</li>
<li>Resources</li>
<li>Outputs</li>
</ol>
<h1 id="내장함수"><a href="#내장함수" class="headerlink" title="내장함수"></a>내장함수</h1><h2 id="Fn-FindInMap"><a href="#Fn-FindInMap" class="headerlink" title="Fn::FindInMap"></a>Fn::FindInMap</h2><p>Fn::FindInMap 내장 함수는 Mappings 섹션에서 선언된 2수준 맵의 키에 해당하는 값을 반환합니다.<br><a href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-findinmap.html" target="_blank" rel="noopener">Fn::FindInMap</a></p>
<h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref"></a>Ref</h2><p>Ref 내장 함수는 지정된 파라미터 또는 리소스에 대한 정보를 반환합니다.<br><a href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-ref.html" target="_blank" rel="noopener">Ref</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Fn::FindInMap: [ MapName, TopLevelKey, SecondLevelKey ] </span><br><span class="line">또는, !FindInMap [ MapName, TopLevelKey, SecondLevelKey ]</span><br><span class="line"></span><br><span class="line">Ref: logicalName 또는, !Ref logicalName</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">AWSRegionArch2AMI:</span><br><span class="line">  us-east-1:</span><br><span class="line">    HVM64: ami-0080e4c5bc078760e</span><br><span class="line">    HVMG2: ami-0aeb704d503081ea6</span><br><span class="line">  us-west-2:</span><br><span class="line">    HVM64: ami-01e24be29428c15b2</span><br><span class="line">    HVMG2: ami-0fe84a5b4563d8f27</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">AWSInstanceType2Arch:</span><br><span class="line">  t1.micro:</span><br><span class="line">    Arch: HVM64</span><br><span class="line">  t2.nano:</span><br><span class="line">    Arch: HVM64</span><br></pre></td></tr></table></figure>
<p>아래 코드는 샘플코드의 일부로, ImageId를 !FindInMap 내장 함수를 통해서 반환을 받는다.<br>이 과정에서, TopLevelKey는 모두 !Ref 내장 함수를 통해 반환받기 때문에, InstanceType에 구애받지 않고 AMI를 지정할 수 있다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ImageId: !FindInMap</span><br><span class="line">  - AWSRegionArch2AMI       &lt;&lt; MapName</span><br><span class="line">  - !Ref &apos;AWS::Region&apos;      &lt;&lt; TopLevelKey (us-east-1, us-west-2, ...)</span><br><span class="line">  - !FindInMap              &lt;&lt; SecondLevelKey</span><br><span class="line">    - AWSInstanceType2Arch</span><br><span class="line">    - !Ref InstanceType     &lt;&lt; t1.micro, t2.nano, ...</span><br><span class="line">    - Arch</span><br></pre></td></tr></table></figure></p>
<h2 id="Fn-Sub"><a href="#Fn-Sub" class="headerlink" title="Fn::Sub"></a>Fn::Sub</h2><h3 id="정의"><a href="#정의" class="headerlink" title="정의"></a>정의</h3><p>내장 함수 Fn::Sub는 입력 문자열의 변수를 지정한 값으로 바꿉니다. 템플릿에 이 함수를 사용해 스택을 생성하거나 업데이트해야만 사용할 수 있는 값이 포함된 명령 또는 출력을 만들 수 있습니다.<br>–&gt; python의 print(“%s” % var)와 같은 문자열 포맷팅과 비슷한 구문으로, 가변적인 값을 반환해야 할 때 사용<br><a href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/intrinsic-function-reference-sub.html" target="_blank" rel="noopener">Fn::Sub</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">!Sub</span><br><span class="line">  - String</span><br><span class="line">  - &#123; Var1Name: Var1Value, Var2Name: Var2Value &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#1. Mapping 사용 예</span><br><span class="line">Name: !Sub</span><br><span class="line">  - www.$&#123;Domain&#125;</span><br><span class="line">  - &#123; Domain: !Ref RootDomainName &#125;</span><br><span class="line"></span><br><span class="line">#2. Mapping 미사용 예</span><br><span class="line">!Sub &apos;arn:aws:ec2:$&#123;AWS::Region&#125;:$&#123;AWS::AccountId&#125;:vpc/$&#123;vpc&#125;&apos;</span><br><span class="line"></span><br><span class="line">#3. userdata 설정 예</span><br><span class="line">UserData:</span><br><span class="line">  Fn::Base64:</span><br><span class="line">    !Sub |</span><br><span class="line">      #!/bin/bash -xe</span><br><span class="line">      yum update -y aws-cfn-bootstrap</span><br><span class="line">      /opt/aws/bin/cfn-init -v --stack $&#123;AWS::StackName&#125; --resource LaunchConfig --configsets wordpress_install --region $&#123;AWS::Region&#125;</span><br><span class="line">      /opt/aws/bin/cfn-signal -e $? --stack $&#123;AWS::StackName&#125; --resource WebServerGroup --region $&#123;AWS::Region&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Run"><a href="#Run" class="headerlink" title="Run"></a>Run</h2><h1 id="AWS-Console"><a href="#AWS-Console" class="headerlink" title="AWS Console"></a>AWS Console</h1><ol>
<li>AWS Console &gt; Cloudstack 접속</li>
<li>Create Stack 클릭 후 Amazon S3 URL 입력, View in Designer 클릭</li>
<li>코드 작성 후 Validation Check 후 Create Stack 가능</li>
</ol>
<h1 id="AWS-CLI"><a href="#AWS-CLI" class="headerlink" title="AWS CLI"></a>AWS CLI</h1><p>아래 Shell Script 참조</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">&lt;&lt;COMMENT</span><br><span class="line">@Name : deploy_template.sh</span><br><span class="line">@Description : Create cloudformation stack and check status</span><br><span class="line">@Input</span><br><span class="line">  - stack_name</span><br><span class="line">  - command_file (TBD)</span><br><span class="line">COMMENT</span><br><span class="line"></span><br><span class="line">REGION=&quot;ap-northeast-1&quot;</span><br><span class="line"></span><br><span class="line">echo -n &quot;STACK NAME : &quot;</span><br><span class="line">read STACK_NAME</span><br><span class="line"></span><br><span class="line">function create_stack()</span><br><span class="line">&#123;</span><br><span class="line">    aws cloudformation create-stack --region $REGION --stack-name $STACK_NAME \</span><br><span class="line">        --template-body file:///home/chronosa/cloudformation/WordPress_Single_Instance.yaml  \</span><br><span class="line">        --parameters ParameterKey=KeyName,ParameterValue=&quot;psj_myformation_tokyo&quot; \</span><br><span class="line">        ParameterKey=InstanceType,ParameterValue=&quot;t2.micro&quot; \</span><br><span class="line">        ParameterKey=SSHLocation,ParameterValue=&quot;0.0.0.0/0&quot; \</span><br><span class="line">        ParameterKey=DBUser,ParameterValue=&quot;test&quot; \</span><br><span class="line">        ParameterKey=DBPassword,ParameterValue=&quot;sksmsxptmxm&quot; \</span><br><span class="line">        ParameterKey=DBRootPassword,ParameterValue=&quot;sksmsvotmdnjem&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">result=$(create_stack)</span><br><span class="line"></span><br><span class="line">if [ $? -ne 0 ]</span><br><span class="line">then</span><br><span class="line">    echo $result</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">STACK_ID=$(echo $result | awk -F &apos;&quot;&apos; &apos;&#123; print $4 &#125;&apos; | tr -d &apos;\n&apos; | tr -d &apos; &apos;)</span><br><span class="line">echo $STACK_ID</span><br><span class="line">while [ 1 ]</span><br><span class="line">do</span><br><span class="line">    cli_result=$(aws cloudformation describe-stacks --stack-name $STACK_ID --region $REGION | grep StackStatus | sed &apos;s/ //g&apos; | tr -d &quot;,&quot;)</span><br><span class="line">    if [ echo &quot;$cli_result&quot; | egrep &quot;ROLLBACK_COMPLETE|CREATE_COMPLETE&quot; ]</span><br><span class="line">    then</span><br><span class="line">        break</span><br><span class="line">    fi</span><br><span class="line">    sleep 3</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<h2 id="AWS-Best-Pratices-architecture"><a href="#AWS-Best-Pratices-architecture" class="headerlink" title="AWS Best Pratices architecture"></a>AWS Best Pratices architecture</h2><p><a href="https://github.com/aws-samples/aws-refarch-wordpress" target="_blank" rel="noopener">Hosting WordPress on AWS</a><br><a href="https://s3-ap-northeast-1.amazonaws.com/cf-templates-11zmew7ilixiu-ap-northeast-1/2019144O1B-new.template4c5u52zx3w6" target="_blank" rel="noopener">https://s3-ap-northeast-1.amazonaws.com/cf-templates-11zmew7ilixiu-ap-northeast-1/2019144O1B-new.template4c5u52zx3w6</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chronosa.github.io/2019/05/30/cloudformation_1/" data-id="cjwaremxn0000evysczuoy1y3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AWS/">AWS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cloudformation/">Cloudformation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DEVOPS/">DEVOPS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-daily_tip_20190530" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/30/daily_tip_20190530/" class="article-date">
  <time datetime="2019-05-30T14:25:15.000Z" itemprop="datePublished">2019-05-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/30/daily_tip_20190530/">today_tip_20190530</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="ARRAY"><a href="#ARRAY" class="headerlink" title="ARRAY"></a>ARRAY</h1><p>BASH에서는 Array를 사용하지 않는 편이다.<br>실제로 쓸 일이 별로 없기도 하고, 맨 처음에 Shell을 배울 때 순수한 Bone Shell의 기능만을 가급적 사용하라는<br>멘토님의 말을 많이 들어서 그런 것 같다.</p>
<p>그래도, 가끔 BASH 코드를 보면 Array가 쓰이는 경우가 있어서 아래정도의 사용 예는 알아두면 좋을 것 같다.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">array_name=(&quot;value 1&quot; &quot;value 2&quot; &quot;value 3&quot;)</span><br><span class="line"> </span><br><span class="line">echo &quot;array_name[0]     = $&#123;array_name[0]&#125;&quot;  #print array_name[0]</span><br><span class="line">echo &quot;array_name[2]     = $&#123;array_name[2]&#125;&quot;  #print array_name[2]</span><br><span class="line">echo &quot;array_name[*]     = $&#123;array_name[*]&#125;&quot;  #print array_name all item</span><br><span class="line">echo &quot;array_name[@]     = $&#123;array_name[@]&#125;&quot;  #print array_name all item</span><br><span class="line">echo &quot;array_name index  = $&#123;!array_name[@]&#125;&quot; #print array_name index number</span><br><span class="line">echo &quot;array_name size   = $&#123;#array_name[@]&#125;&quot; #print array_name size</span><br><span class="line">echo &quot;array_name[0] size= $&#123;#array_name[0]&#125;&quot; #print array_name[0] size</span><br></pre></td></tr></table></figure></p>
<p><a href="http://blog.redjini.com/282" target="_blank" rel="noopener">출처</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chronosa.github.io/2019/05/30/daily_tip_20190530/" data-id="cjwaremy60004evysboyaizji" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/bash/">bash</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/daily-tip/">daily_tip</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cloudformation_3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/29/cloudformation_3/" class="article-date">
  <time datetime="2019-05-29T07:10:39.000Z" itemprop="datePublished">2019-05-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/29/cloudformation_3/">cloudformation_3 (CloudFormer)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="CloudFormer"><a href="#CloudFormer" class="headerlink" title="CloudFormer"></a>CloudFormer</h1><h2 id="CloudFormer란"><a href="#CloudFormer란" class="headerlink" title="CloudFormer란?"></a>CloudFormer란?</h2><p>Public Document에는 아래와 같이 정의되어 있음<br>…<br>CloudFormer는 계정의 기존 AWS 리소스에서 AWS CloudFormation 템플릿을 생성하는 템플릿 생성 베타 도구입니다. 계정에서 실행 중인 지원되는 AWS 리소스를 선택하면 CloudFormer가 Amazon S3 버킷에 템플릿을 생성합니다.<br>…<br><a href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/cfn-using-cloudformer.html" target="_blank" rel="noopener">Docs</a></p>
<p>다만 아직 Beta라서 PRD에는 적용을 가급적 삼가고, 적용하더라도 소스코드 전수점검 및 사전 테스트가 필요할 것 같다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chronosa.github.io/2019/05/29/cloudformation_3/" data-id="cjwaremxz0003evysldi95fop" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AWS/">AWS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cloudformation/">Cloudformation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DEVOPS/">DEVOPS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-cloudformation_2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/27/cloudformation_2/" class="article-date">
  <time datetime="2019-05-27T04:53:44.000Z" itemprop="datePublished">2019-05-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/27/cloudformation_2/">cloudformation-2 (UPDATE)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Cloudformation의-변경-방식"><a href="#Cloudformation의-변경-방식" class="headerlink" title="Cloudformation의 변경 방식"></a>Cloudformation의 변경 방식</h1><h2 id="개요-Change-Set을-통한-업데이트"><a href="#개요-Change-Set을-통한-업데이트" class="headerlink" title="개요 - Change Set을 통한 업데이트"></a>개요 - Change Set을 통한 업데이트</h2><p>스택을 업데이트하려면 원본 스택 템플릿의 수정된 버전, 다른 입력 파라미터 또는 둘 다를 제출하여 변경 세트를 생성합니다. AWS CloudFormation에서는 수정된 템플릿을 원본 템플릿과 비교해 변경 세트를 생성합니다. 변경 세트에는 제안된 변경 사항이 나열되어 있습니다. 변경 사항을 검토한 후 변경 세트를 실행해 스택을 업데이트하거나 새 변경 세트를 생성할 수 있습니다. 다음 다이어그램은 스택 업데이트 워크플로우를 요약해서 보여줍니다.<br><img src="/images/update-stack-diagram.png" alt="update-stack-diagram.png"><br><a href="https://docs.aws.amazon.com/ko_kr/AWSCloudFormation/latest/UserGuide/cfn-whatis-howdoesitwork.html" target="_blank" rel="noopener">출처</a></p>
<h2 id="스택-리소스의-업데이트-동작"><a href="#스택-리소스의-업데이트-동작" class="headerlink" title="스택 리소스의 업데이트 동작"></a>스택 리소스의 업데이트 동작</h2><p>스택 리소스를 업데이트 할 수 있는 방법은 아래 두가지이다.</p>
<ol>
<li>직접 업데이트</li>
<li>변경 세트(Change Set)을 통한 업데이트<br>업데이트 동작은 총 세 가지 동작으로 나뉘게 된다.</li>
<li>업데이트(무중단)</li>
<li>업데이트(중단) : 다운타임이 발생하지만 물리적 ID는 유지</li>
<li>대체 : 리소스가 다시 생성되며 물리적 ID도 새로 생성</li>
</ol>
<p>또한, 중첩된 스택(AWS::CloudFormation::Stack)이 포함되어 있는 경우 해당 스택들도 같이 업데이트가 수행되게 된다.</p>
<h2 id="변경-세트를-사용하여-스택-업데이트"><a href="#변경-세트를-사용하여-스택-업데이트" class="headerlink" title="변경 세트를 사용하여 스택 업데이트"></a>변경 세트를 사용하여 스택 업데이트</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Validate Check</span><br><span class="line">aws cloudformation validate-template --template-body file://first_template.yaml</span><br><span class="line"># Deploy (Dry-Run)</span><br><span class="line">aws cloudformation deploy --stack-name sj1117park-make --template-file first_template.yaml --parameter-overrides &quot;AvailabilityZones=ap-northeast-1a&quot; --no-execute-changeset --region ap-northeast-1</span><br><span class="line"># Run Check</span><br><span class="line">aws cloudformation describe-change-set --change-set-name arn:aws:cloudformation:ap-northeast-2:912698603521:changeSet/awscli-cloudformation-package-deploy-1558935846/62085961-adf3-4787-8f7e-f92c4579541a --region ap-northeast-1</span><br><span class="line"># Deploy</span><br><span class="line">aws cloudformation deploy --stack-name sj1117park-make --template-file first_template.yaml --parameter-overrides &quot;AvailabilityZones=ap-northeast-1a&quot; --region ap-northeast-1</span><br></pre></td></tr></table></figure>
<p><img src="/images/update-stack-changesets-diagram.png" alt="update-stack-changesets-diagram.png"></p>
<h2 id="실제-스택-생성"><a href="#실제-스택-생성" class="headerlink" title="실제 스택 생성"></a>실제 스택 생성</h2><p><a href="https://github.com/aws-samples/aws-refarch-wordpress" target="_blank" rel="noopener">참조</a><br><a href="https://aws.amazon.com/ko/quickstart/?quickstart-all.sort-by=item.additionalFields.publishDate&amp;quickstart-all.sort-order=desc" target="_blank" rel="noopener">Quick Starts</a></p>
<ol>
<li><a href="https://aws.amazon.com/ko/quickstart/architecture/linux-bastion/" target="_blank" rel="noopener">AWS 기반 Linux 배스천 호스트</a></li>
<li><a href="https://aws.amazon.com/ko/quickstart/architecture/cicd-taskcat/" target="_blank" rel="noopener">AWS 기반 AWS CloudFormation 템플릿용 CI/CD 파이프라인</a></li>
</ol>
<h2 id="과정"><a href="#과정" class="headerlink" title="과정"></a>과정</h2><ol>
<li>VPC 생성</li>
<li>Subnet 생성</li>
<li>EC2 생성</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chronosa.github.io/2019/05/27/cloudformation_2/" data-id="cjwaremxv0001evys848jvtwm" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/AWS/">AWS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cloudformation/">Cloudformation</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DEVOPS/">DEVOPS</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/26/hello-world/" class="article-date">
  <time datetime="2019-05-26T15:18:53.882Z" itemprop="datePublished">2019-05-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/26/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="noopener">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="noopener">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="noopener">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="noopener">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="noopener">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="noopener">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="noopener">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chronosa.github.io/2019/05/26/hello-world/" data-id="cjwaremya0007evyszwjmt5bs" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWS/">AWS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cloudformation/">Cloudformation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DEVOPS/">DEVOPS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GCP/">GCP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Monitoring/">Monitoring</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/">bash</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/daily-tip/">daily_tip</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/AWS/" style="font-size: 20px;">AWS</a> <a href="/tags/Cloudformation/" style="font-size: 20px;">Cloudformation</a> <a href="/tags/DEVOPS/" style="font-size: 20px;">DEVOPS</a> <a href="/tags/GCP/" style="font-size: 10px;">GCP</a> <a href="/tags/Monitoring/" style="font-size: 10px;">Monitoring</a> <a href="/tags/bash/" style="font-size: 10px;">bash</a> <a href="/tags/daily-tip/" style="font-size: 10px;">daily_tip</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/05/30/gcp_1/">GCP NOTE-1</a>
          </li>
        
          <li>
            <a href="/2019/05/30/cloudformation_1/">cloudformation-1 (INTRO)</a>
          </li>
        
          <li>
            <a href="/2019/05/30/daily_tip_20190530/">today_tip_20190530</a>
          </li>
        
          <li>
            <a href="/2019/05/29/cloudformation_3/">cloudformation_3 (CloudFormer)</a>
          </li>
        
          <li>
            <a href="/2019/05/27/cloudformation_2/">cloudformation-2 (UPDATE)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Jin<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>